<!DOCTYPE html>
<html lang="en">
<head>
    <title>RxJS: введение</title>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="node_modules/tinkoff-shower/theme/styles.css">
    <link rel="stylesheet" href="custom/styles.css">

    <link rel="icon" sizes="16x16" href="pictures/favicon-16x16.png">
    <link rel="icon" sizes="32x32" href="pictures/favicon-32x32.png">
    <link rel="icon" sizes="96x96" href="pictures/favicon-96x96.png">
</head>
<body class="shower list stachka">

<template id="timeline-template" class="hidden">
    <div class="timeline" style="width: 0px;"></div>
</template>

<header class="caption">
    <h1>RxJS: введение</h1>
</header>

<section class="slide invert" id="cover">
    <div class="intro">
        <img width="300" class="intro-img" src="pictures/rxjs-logo.png" alt="RxJS">
    </div>
    <div class="cover-title">
        <h2>RxJS<br>введение</h2>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">О чем поговорим</h2>
    <div class="slide-description">
        <ul>
            <li>Реактивный подход</li>
            <li>Observable</li>
            <li>Операторы Rx</li>
            <li>Демо</li>
            <li>Subjects</li>
            <li>Написание кастомных операторов</li>
        </ul>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Реактивный подход</h2>
    <div class="slide-description">
        <img class="img-boxed" width="526" src="pictures/table-1.png" alt="A1 = 1; B1 = 3; C1 = A1 + B1 = 4">

        <div class="two-columns">
            <div>
                <p class="excel next">
                    <code>A1 = 1; B1 = 3;</code>
                    <br>
                    <code>
                        <mark>C1 = A1 + B1;</mark>
                    </code>
                </p>
            </div>
        </div>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Реактивный подход</h2>
    <div class="slide-description">
        <img class="img-boxed" width="526" src="pictures/table-1.png" alt="A1 = 1; B1 = 3; C1 = A1 + B1 = 4">

        <div class="two-columns">
            <div>
                <p class="excel">
                    <code>A1 = 1; B1 = 3;</code>
                    <br>
                    <code>C1 = A1 + B1;</code>
                    <br>
                    <code>
                        <mark>C1 ~ 4;</mark>
                    </code>
                </p>
            </div>
        </div>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Реактивный подход</h2>
    <div class="slide-description">
        <img class="img-boxed" width="526" src="pictures/table-2.png" alt="A1 = 2; B1 = 3; C1 = A1 + B1 = 4">

        <div class="two-columns">
            <div>
                <p class="excel">
                    <code>A1 = 1; B1 = 3;</code>
                    <br>
                    <code>C1 = A1 + B1;</code>
                    <br>
                    <code>C1 ~ 4;</code>
                </p>
                <p class="excel">
                    <code>
                        <mark>A1 = 2;</mark>
                    </code>
                </p>
            </div>
        </div>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Реактивный подход</h2>
    <div class="slide-description">
        <img class="img-boxed" width="526" src="pictures/table-3.png" alt="A1 = 2; B1 = 3; C1 = A1 + B1 = 5">
        <div class="two-columns">
            <div>
                <p class="excel">
                    <code>A1 = 1; B1 = 3;</code>
                    <br>
                    <code>C1 = A1 + B1;</code>
                    <br>
                    <code>C1 ~ 4;</code>
                </p>
                <p class="excel">
                    <code>A1 = 2;</code>
                    <br>
                    <code>
                        <mark>C1 ~ 5;</mark>
                    </code>
                </p>
            </div>
        </div>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Реактивный подход</h2>
    <div class="slide-description">
        <div class="two-columns">
            <div>
                <p>
                    <strong>Push-стратегия</strong>
                </p>
                <p class="excel">
                    <code>A1 = 1; B1 = 3;</code>
                    <br>
                    <code>C1 = A1 + B1;</code>
                    <br>
                    <code>C1 ~ 4;</code>
                </p>
                <p class="excel">
                    <code>A1 = 2;</code>
                    <br>
                    <code>C1 ~ 5;</code>
                </p>
            </div>
            <div>
            </div>
        </div>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Императивный подход</h2>
    <div class="slide-description">
        <div class="two-columns">
            <div>
                <p>
                    <strong>Push-стратегия</strong>
                </p>
                <p class="excel">
                    <code>A1 = 1; B1 = 3;</code>
                    <br>
                    <code>C1 = A1 + B1;</code>
                    <br>
                    <code>C1 ~ 4;</code>
                </p>
                <p class="excel">
                    <code>A1 = 2;</code>
                    <br>
                    <code>C1 ~ 5;</code>
                </p>
            </div>
            <div>
                <p>
                    <strong>Pull-статегия</strong>
                </p>
                <p class="excel next">
                    <code>A1 = 1; B1 = 3;</code>
                    <br>
                    <code>C1 = A1 + B1;</code>
                    <br>
                    <code class="next">C1 ~ 4;</code>
                </p>
                <p class="excel next">
                    <code>A1 = 2;</code>
                    <br>
                    <code class="next">
                        <mark>C1 ~ 4;</mark>
                    </code>
                </p>
            </div>
        </div>
    </div>
</section>

<section class="slide">
    <h2 class="shout shout-small">
        Поток событий
    </h2>
</section>

<section class="slide">
    <h2 class="slide-header">Поток событий</h2>
    <div class="slide-description">
        <img width="727" class="img-centered" src="pictures/rxjs-clicks-1.png" alt="Поток кликов">
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Поток событий</h2>
    <div class="slide-description">
        <img width="727" class="img-centered" src="pictures/rxjs-clicks-2.png" alt="Поток кликов">
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Поток событий</h2>
    <div class="slide-description">
        <img width="727" class="img-centered" src="pictures/rxjs-clicks-2-2.png" alt="Поток кликов">
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Поток событий</h2>
    <div class="slide-description">
        <img width="727" class="img-centered" src="pictures/rxjs-clicks-3.png" alt="Поток кликов">
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Поток событий</h2>
    <div class="slide-description">
        <img width="727" class="img-centered" src="pictures/rxjs-clicks-4.png" alt="Поток кликов">
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Поток событий</h2>
    <div class="slide-description">
        <pre>
            <code><mark><span
                class="rxjs-creation">from</span>([{x: 11, y: 99}, {x: 91, y: 151}, {x: 152, y: 106}]).<span
                class="rxjs-pipe">pipe</span>(</mark></code>
            <code class="next">    <span class="rxjs-operator">map</span>((value) => { ... }),</code>
            <code class="next">    <span class="rxjs-operator">filter</span>((value) => { ... }),</code>
            <code class="next">    <span class="rxjs-operator">reduce</span>((acc, curr) => { ... })</code>
            <div class="next">
                <code>).<span class="rxjs-subscribe">subscribe</span>(result => {</code>
            <code>    console.log(result);</code>
            <code>});</code>
            </div>
        </pre>
    </div>
</section>

<section class="slide">
    <h2 class="shout shout-small">
        Поток событий
        <br>~<br>
        массив,
        распределенный
        во&nbsp;времени
        <br><br>
    </h2>
</section>

<section class="slide">
    <h2 class="shout">
        Observable
        <br>
        <small class="nowrap">Observer pattern + Iterator pattern</small>
    </h2>
</section>

<section class="slide">
    <h2 class="slide-header">Observer pattern</h2>
    <div class="slide-description">
        <small>
            <pre>
                <code>class Subject {</code>
                <div class="next">
                <code>    constructor() {</code>
                <code>        this.observers = [];</code>
                <code>    }</code>
                </div>
                <code class="next">    add(observer) {...}</code>
                <code class="next">    remove(observer) {...}</code>
                <div class="next">
                <code>    notify(value) {</code>
                <code>        this.observers.forEach(observer => {</code>
                    <code>            observer.<mark>update(value)</mark></code>
                <code>        });</code>
                <code>    }</code>
                </div>
                <code>}</code>
            </pre>
        </small>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Observer pattern</h2>
    <div class="slide-description">
        <br>
        <img width="798" class="img-centered" src="pictures/observer-pattern.png" alt="Observer">
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Observer pattern</h2>
    <div class="slide-description">
        <p><strong>Субъект</strong> изменяет значения.
            <br>
            Также называется <strong>Observable</strong>, наблюдаемый объект.</p>
        <p><strong>Наблюдатель (Observer)</strong> реагирует на&nbsp;изменения.</p>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Iterator pattern</h2>
    <div class="slide-description">
        <small>
            <pre>
                <code>class Iterator {</code>
                <div class="next">
                <code> </code>
                <code>    next() {...}</code>
                </div>
                <div class="next">
                <code> </code>
                <code>    hasNext() {...}</code>
                <code> </code>
                <code>}</code>
                </div>
            </pre>
        </small>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Iterator pattern</h2>
    <div class="slide-description">
        <ul>
            <li>последовательный обход составных объектов</li>
            <li>не раскрывается внутреннее представление</li>
        </ul>
        <img width="798" class="img-centered" src="pictures/iterator-pattern.png" alt="Observer">
    </div>
</section>

<section class="slide">
    <h2 class="shout">
        Observable
    </h2>
</section>

<section class="slide">
    <h2 class="slide-header">Observable</h2>
    <div class="slide-description">
        <div class="playground" id="observableDef"></div>
        <button class="btn btn-play" onclick="run(observableDef, this)">▶</button>
    </div>
    <small>
        <pre>
            <code>const stream$ = <span class="rxjs-creation">Observable.create</span>((observer) => {</code>
                <code>    observer.next(1);</code>
                <code>    setTimeout(() => { observer.next(2);},    1000);</code>
                <code>    setTimeout(() => { observer.next(3);},    2000);</code>
                <code>    setTimeout(() => { observer.complete();}, 3000);</code>
                <code>});</code>
                <code>const subscribtion = stream$.<span class="rxjs-subscribe">subscribe</span>({</code>
                <code>    next: (value) => renderNext(value),</code>
                <code>    error: (error) => renderError(error),</code>
                <code>    complete: () => renderComplete()</code>
                <code>});</code>
        </pre>
    </small>
    <script>
        function observableDef() {
            const playgroundElement = document.getElementById('observableDef');
            playgroundElement.innerHTML = '';

            const stream$ = rxjs.Observable.create((observer) => {
                observer.next(1);
                setTimeout(() => {
                    observer.next(2);
                }, 1000);
                setTimeout(() => {
                    observer.next(3);
                }, 2000);
                setTimeout(() => {
                    observer.complete()
                }, 3000);
            });

            startStream(playgroundElement, stream$);
        }
    </script>
</section>

<section class="slide">
    <h2 class="slide-header">Observable</h2>
    <div class="slide-description">
        <p>
            <mark>Observable</mark>
            – наблюдаемый объект, доставляет&nbsp;изменения в подписку.
        </p>
    </div>
    <small>
        <pre>
            <code>const <mark class="highlight next">stream$</mark> = <mark><span class="rxjs-creation">Observable.create</span></mark>((observer) => {...});</code>
            <code> </code>
            <code>const subscribtion = stream$.<mark class="highlight next"><span
                class="rxjs-subscribe">subscribe</span></mark>(...);</code>
        </pre>
    </small>
</section>

<section class="slide">
    <h2 class="slide-header">Observable</h2>
    <div class="slide-description">
        <p>
            <mark>Observer</mark>
            – объект-наблюдатель,
            <br>
            опциональные обработчики next/error/complete
        </p>
    </div>
    <small>
        <pre>
            <code>const subscribtion = stream$.<span class="rxjs-subscribe">subscribe</span>(</code>
            <code>    {</code>
            <code>        next: <span class="next">(value) => renderNext(value),</span></code>
            <code>        error: <span class="next">(error) => renderError(error),</span></code>
            <code>        complete: <span class="next">() => renderComplete()</span></code>
            <code>    }</code>
            <code>);</code>
            <div class="next">
            <code>stream$.<span
                class="rxjs-subscribe">subscribe</span>((value) => renderNext(value));</code>
            </div>
        </pre>
    </small>
</section>

<section class="slide">
    <h2 class="slide-header">Observable</h2>
    <div class="slide-description">
        <p>
            <mark>Функция создания</mark>
            определяет, <br>как наблюдатель
            будет получать значения.
        </p>
    </div>
    <small>
        <pre>
            <code>const stream$ = <span class="rxjs-creation">Observable.create</span>((<span class="rxjs-operator">observer</span>) => {</code>
            <code class="next">    <span class="rxjs-operator">observer</span>.next(<span class="rxjs-operator">1</span>);</code>
            <code class="next">    setTimeout(() => { <span class="rxjs-operator">observer</span>.next(<span class="rxjs-operator">2</span>);},    1000);</code>
            <code class="next">    setTimeout(() => { <span class="rxjs-operator">observer</span>.next(<span class="rxjs-operator">3</span>);},    2000);</code>
            <code class="next">    setTimeout(() => { <span class="rxjs-operator">observer</span>.complete();}, 3000);</code>
            <code>});</code>
            <br>
            <code class="next">stream$.<span class="rxjs-subscribe">subscribe</span>(renderNext);</code>
        </pre>
    </small>
    <div class="playground next">
        <div class="timeline" style="width: 300.8px; color: rgb(251, 0, 13); transition-duration: 0s;">
            <div class="entry" style="left: 0.6px;">1</div>
            <div class="entry" style="left: 100.7px;">2</div>
            <div class="entry" style="left: 200.7px;">3</div>
            <div class="entry-complete" style="left: 300.7px;"></div>
        </div>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Observable</h2>
        <small>
        <pre>
            <code>const stream$ = <span class="rxjs-creation">Observable.create</span>((<span class="rxjs-operator">observer</span>) => {</code>
            <code>    <span class="rxjs-operator">observer</span>.next(<span class="rxjs-operator">1</span>);</code>
            <code>    setTimeout(() => { <span class="rxjs-operator">observer</span>.next(<span class="rxjs-operator">2</span>);},    1000);</code>
            <code>    setTimeout(() => { <span class="rxjs-operator">observer</span>.next(<span class="rxjs-operator">3</span>);},    2000);</code>
            <code>    setTimeout(() => { <span class="rxjs-operator">observer</span>.complete();}, 3000);</code>
            <code>});</code>
            <br>
            <code>const promise = new Promise((<span class="rxjs-operator">resolve</span>, <span class="rxjs-operator">reject</span>) => {</code>
            <code>  <span class="rxjs-operator">resolve</span>(<span class="rxjs-operator">1</span>);</code>
            <code>});</code>
        </pre>
        </small>
</section>

<section class="slide">
    <h2 class="slide-header">Observable</h2>
    <div class="slide-description">
        <p>
            <mark>Subscribtion</mark>
            – подписка. <br>Старт получения значений.
        </p>
    </div>
    <small>
        <pre>
            <code>const stream$ = <span class="rxjs-creation">Observable.create</span>((observer) => {...});</code>
            <code> </code>
            <code>const <mark>subscribtion</mark> = stream$.<span class="rxjs-subscribe">subscribe</span>(...);</code>
            <code class="next">subscribtion.<span class="rxjs-subscribe">unsubscribe</span>();</code>
        </pre>
    </small>
</section>

<section class="slide">
    <h2 class="slide-header">Observable</h2>
    <div class="slide-description">
        <p>
            <mark>unsubscribe</mark> – завершение получения значений.
        </p>
    </div>
    <smallЮ>
        <pre>
            <code>const stream$ = <span class="rxjs-creation">Observable.create</span>((observer) => {</code>
            <code>    const interval = setInterval(() => observer.next(1), 1000);</code>
            <div class="next invisible-next">
            <code> </code>
            <code>    <mark>return function unsubscribe()</mark> { </code>
            <code>        clearInterval(interval);</code>
            <code>    }</code>
            </div>
            <code>});</code>
            <code> </code>
            <code>const subscribtion = stream$.<span class="rxjs-subscribe">subscribe</span>(...);</code>
            <code>subscribtion.<mark><span class="rxjs-subscribe">unsubscribe</span>();</mark></code>
        </pre>
    </small>
</section>

<section class="slide">
    <h2 class="shout">
        Операторы RxJS
    </h2>
</section>

<section class="slide">
    <h2 class="slide-header">Cоздание Observable</h2>
    <div class="slide-description">
        <pre>
            <code class="text-muted">import {<span class="rxjs-creation">from</span>} from 'rxjs';</code>
            <code>const promise = new Promise((resolve) => { resolve('foo')});</code>
            <code><span class="rxjs-creation">from</span>(promise);</code>
            <code class="next text-muted">// ----------------foo-|</code>
            <div class="next">
            <code> </code>
            <code class="text-muted">import {<span class="rxjs-creation">fromEvent</span>} from 'rxjs';</code>
            <code>const btnElement = document.getElementById('btn');</code>
            <code><span class="rxjs-creation">fromEvent</span>(btnElement, 'click');</code>
            <code class="next text-muted">// --evt-evt------evt----evt--...</code>
            </div>
        </pre>
        </small>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Операторы преобразования</h2>
    <div class="slide-description">
        <div class="playground playground-two-streams" id="operatorsExample1"></div>
        <button class="btn btn-play" onclick="run(operatorsExample1, this)">▶</button>
    </div>
    <small>
        <pre>
            <code class="text-muted">import {<span class="rxjs-operator">take</span>, <span
                class="rxjs-operator">filter</span>} from 'rxjs/operators';</code>
            <code><span class="rxjs-creation">timer</span>(0, 500).<span class="rxjs-pipe">pipe</span>(</code>
            <code>    <span class="rxjs-operator">take</span>(12)</code>
            <code>).<span class="rxjs-subscribe">subscribe</span>(renderNext);</code>
            <div class="next">
                <code> </code>
                <code><span class="rxjs-creation">timer</span>(0, 500).<span class="rxjs-pipe">pipe</span>(</code>
                <code>    <span class="rxjs-operator">take</span>(12),</code>
                <code>    <span class="rxjs-operator">filter</span>(() => Math.random() < 0.3)</code>
                <code>).<span class="rxjs-subscribe">subscribe</span>(renderNext);</code>
            </div>
        </pre>
    </small>
    <script>
        function operatorsExample1() {
            const playgroundElement = document.getElementById('operatorsExample1');
            playgroundElement.innerHTML = '';

            const streamA$ = rxjs.timer(0, 500)
                .pipe(
                    rxjs.operators.take(12)
                );

            const streamB$ = rxjs.timer(0, 500)
                .pipe(
                    rxjs.operators.take(12),
                    rxjs.operators.filter(() => Math.random() < 0.3)
                );

            startStream(playgroundElement, streamA$);
            startStream(playgroundElement, streamB$);
        }
    </script>
</section>

<section class="slide">
    <h2 class="slide-header">Pipe</h2>
    <div class="slide-description">
        <pre class="margin-0">
            <code>.<span class="rxjs-pipe">pipe</span>(</code>
        </pre>
        <img class="img-boxed img-centered" style="margin-top: 10px; margin-bottom: 10px;" width="600" src="pictures/pipe-3.gif"
             alt="pipe в реальном мире">
        <pre class="margin-0">
            <code>).<span class="rxjs-subscribe">subscribe</span>(...)</code>
        </pre>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Rx Marble Diagram</h2>
    <div class="slide-description text-center">
        <img class="img-boxed img-centered" style="margin-top: 50px;" width="650" src="pictures/rxmarbles-filter.png"
             alt="Rx Marble Diagram: filter">
        <pre class="pre-centered-big next">
            <code>---2--30--22--5--60--1-----|</code>
            <code>filter(x => x > 10)         </code>
            <code>------30--22-----60--------|</code>
        </pre>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Операторы преобразования</h2>
    <div class="slide-description">
        <div class="playground playground-two-streams" id="operatorsExample2"></div>
        <button class="btn btn-play" onclick="run(operatorsExample2, this)">▶</button>
        <pre>
            <code><span class="rxjs-creation">timer</span>(0, 250).<span class="rxjs-pipe">pipe</span>(</code>
            <code>    <span class="rxjs-operator">take</span>(40),</code>
            <code>    <span class="rxjs-operator">filter</span>(() => Math.random() < 0.3),</code>
            <code>    <mark><span class="rxjs-operator">debounceTime</span>(500)</mark></code>
            <code>).<span class="rxjs-subscribe">subscribe</span>(renderNext);</code>
        </pre>
    </div>
    <script>
        function operatorsExample2() {
            const playgroundElement = document.getElementById('operatorsExample2');
            playgroundElement.innerHTML = '';

            const streamA$ = rxjs.timer(0, 250)
                .pipe(
                    rxjs.operators.take(40),
                    rxjs.operators.filter(() => Math.random() < 0.3),
                    rxjs.operators.share()
                );

            const streamB$ = streamA$
                .pipe(
                    rxjs.operators.debounceTime(500)
                );

            startStream(playgroundElement, streamA$);
            startStream(playgroundElement, streamB$);
        }
    </script>
</section>

<section class="slide">
    <h2 class="slide-header">Комбинирование: merge</h2>
    <div class="slide-description">
        <div class="playground playground-three-streams" id="operatorMerge"></div>
        <button class="btn btn-play" onclick="run(operatorMerge, this)">▶</button>
        <pre>
            <code>const streamA$ = <span class="rxjs-creation">timer</span>(0, 1500).<span class="rxjs-pipe">pipe</span>(<span
                class="rxjs-operator">take</span>(4));</code>
            <code>const streamB$ = <span class="rxjs-creation">timer</span>(800, 1000).<span
                class="rxjs-pipe">pipe</span>(</code>
            <code>    <span class="rxjs-operator">take</span>(6),</code>
            <code>    <span class="rxjs-operator">map</span>((i) => 'abcdef'[i])</code>
            <code>);</code>
            <code><span class="rxjs-creation">merge</span>(streamA$, streamB$)</code>
            <code>    .<span class="rxjs-subscribe">subscribe</span>(renderNext);</code>
        </pre>
    </div>
    <script>
        function operatorMerge() {
            const playgroundElement = document.getElementById('operatorMerge');
            playgroundElement.innerHTML = '';

            const streamA$ = rxjs.timer(0, 1500)
                .pipe(
                    rxjs.operators.take(4)
                );

            const streamB$ = rxjs.timer(800, 1000)
                .pipe(
                    rxjs.operators.take(6),
                    rxjs.operators.map((value) => 'abcdef'[value])
                );

            const streamAB$ = rxjs.merge(streamA$, streamB$);

            startStream(playgroundElement, streamA$);
            startStream(playgroundElement, streamB$);
            startStream(playgroundElement, streamAB$);
        }
    </script>
</section>

<section class="slide">
    <h2 class="slide-header">Комбинирование: combineLatest</h2>
    <div class="slide-description">
        <div class="playground playground-three-streams" id="operatorCombineLatest"></div>
        <button class="btn btn-play" onclick="run(operatorCombineLatest, this)">▶</button>
        <pre>
            <code>const streamA$ = <span class="rxjs-creation">timer</span>(0, 1500).<span class="rxjs-pipe">pipe</span>(<span
                class="rxjs-operator">take</span>(4));</code>
            <code>const streamB$ = <span class="rxjs-creation">timer</span>(800, 1000).<span
                class="rxjs-pipe">pipe</span>(</code>
            <code>    <span class="rxjs-operator">take</span>(6),</code>
            <code>    <span class="rxjs-operator">map</span>((i) => 'abcdef'[i])</code>
            <code>);</code>
            <code><span class="rxjs-creation">combineLatest</span>(streamA$, streamB$).<span
                class="rxjs-pipe">pipe</span>(</code>
            <code>    <span class="rxjs-operator">map</span>(([a, b]) => a + b)</code>
            <code>).<span class="rxjs-subscribe">subscribe</span>(renderNext);</code>
        </pre>
    </div>
    <script>
        function operatorCombineLatest() {
            const playgroundElement = document.getElementById('operatorCombineLatest');
            playgroundElement.innerHTML = '';

            const streamA$ = rxjs.timer(0, 1500)
                .pipe(
                    rxjs.operators.take(4)
                );

            const streamB$ = rxjs.timer(800, 1000)
                .pipe(
                    rxjs.operators.map((value) => 'abcdef'[value]),
                    rxjs.operators.take(6)
                );

            const streamAB$ = rxjs.combineLatest(streamA$, streamB$)
                .pipe(
                    rxjs.operators.map(([a, b]) => a + b)
                );

            startStream(playgroundElement, streamA$);
            startStream(playgroundElement, streamB$);
            startStream(playgroundElement, streamAB$);
        }
    </script>
</section>

<section class="slide">
    <h2 class="slide-header">Операторы высшего порядка: mergeMap</h2>
    <div class="slide-description">
        <div class="playground playground-two-streams" id="operatorMergeMap"></div>
        <button class="btn btn-play" onclick="run(operatorMergeMap, this)">▶</button>
        <pre>
            <code><span class="rxjs-creation">timer</span>(0, 1500).<span class="rxjs-pipe">pipe</span>(</code>
            <code>    <span class="rxjs-operator">take</span>(3),</code>
            <code>    <span class="rxjs-operator">map</span>((i) => 'abcd'[i]),</code>
            <code>    <mark><span class="rxjs-operator">mergeMap</span></mark>(letter => {</code>
            <code>        return <span class="rxjs-creation">timer</span>(0, 450).<span
                class="rxjs-pipe">pipe</span>(</code>
            <code>            <span class="rxjs-operator">take</span>(6),</code>
            <code>            <span class="rxjs-operator">map</span>(digit => letter + digit));</code>
            <code>    })</code>
            <code>).<span class="rxjs-subscribe">subscribe</span>(renderNext);</code>
        </pre>
    </div>
    <script>
        function operatorMergeMap() {
            const playgroundElement = document.getElementById('operatorMergeMap');
            playgroundElement.innerHTML = '';

            const streamA$ = rxjs.timer(0, 1500)
                .pipe(
                    rxjs.operators.take(3),
                    rxjs.operators.map((value) => 'abcd'[value])
                );

            const streamB$ = streamA$
                .pipe(
                    rxjs.operators.mergeMap(value => {
                        return rxjs.timer(0, 450)
                            .pipe(
                                rxjs.operators.take(6),
                                rxjs.operators.map(innerValue => value + innerValue)
                            );
                    })
                );

            startStream(playgroundElement, streamA$);
            startStream(playgroundElement, streamB$);
        }
    </script>
</section>

<section class="slide">
    <h2 class="slide-header">Операторы высшего порядка: switchMap</h2>
    <div class="slide-description">
        <div class="playground playground-two-streams" id="operatorSwitchMap"></div>
        <button class="btn btn-play" onclick="run(operatorSwitchMap, this)">▶</button>
    </div>
    <small>
        <pre>
            <code><span class="rxjs-creation">timer</span>(0, 1500).<span class="rxjs-pipe">pipe</span>(</code>
            <code>    <span class="rxjs-operator">take</span>(3),</code>
            <code>    <span class="rxjs-operator">map</span>((i) => 'abcd'[i]),</code>
            <code>    <mark><span class="rxjs-operator">switchMap</span></mark>(letter => {</code>
            <code>        return <span class="rxjs-creation">timer</span>(0, 450).<span
                class="rxjs-pipe">pipe</span>(</code>
            <code>            <span class="rxjs-operator">take</span>(6),</code>
            <code>            <span class="rxjs-operator">map</span>(digit => letter + digit));</code>
            <code>    })</code>
            <code>).<span class="rxjs-subscribe">subscribe</span>(renderNext);</code>
        </pre>
    </small>
    <script>
        function operatorSwitchMap() {
            const playgroundElement = document.getElementById('operatorSwitchMap');
            playgroundElement.innerHTML = '';

            const streamA$ = rxjs.timer(0, 1500)
                .pipe(
                    rxjs.operators.take(3),
                    rxjs.operators.map((value) => 'abcd'[value])
                );

            const streamB$ = streamA$
                .pipe(
                    rxjs.operators.switchMap(value => {
                        return rxjs.timer(0, 450)
                            .pipe(
                                rxjs.operators.take(6),
                                rxjs.operators.map(innerValue => value + innerValue)
                            );
                    })
                );

            startStream(playgroundElement, streamA$);
            startStream(playgroundElement, streamB$);
        }
    </script>
</section>

<section class="slide">
    <h2 class="shout">
        SwitchMap
    </h2>
</section>

<section class="slide">
    <h2 class="slide-header">SwitchMap и отписки</h2>
    <div class="slide-description">
        <p><strong>SwitchMap</strong> автоматически отписывает внутренний поток — вызывает subscription.<span
            class="rxjs-subscribe">unsubscribe</span>()
        </p>
        <p class="next">Можем написать отменяемые запросы:</p>
        <ul>
            <li class="next">Angular HttpClient</li>
            <li class="next">Fetch + AbortController</li>
            <li class="next">XMLHttpRequest -> xhr.abort()</li>
        </ul>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Пример: отменяемый fetch</h2>
    <div class="slide-description">
        <pre>
            <code>const request$ = <span class="rxjs-creation">Observable.create</span>((observer) => {</code>
            <div class="next">
            <code>    const controller = <mark>new AbortController();</mark></code>
            <code>    const signal = controller.signal;</code>
            </div>
            <div class="next">
            <code> </code>
            <code>    fetch(url, <mark>{signal}</mark>).then(res => res.json())</code>
            </div>
            <div class="next">
            <code>        .then(data => {</code>
            <code>                observer.next(data);</code>
            <code>                observer.complete();</code>
            <code>            });</code>
            </div>
            <div class="next">
            <code> </code>
            <code>    <mark>return function unsubscribe() {</mark></code>
            <code>        <mark>controller.abort();</mark></code>
            <code>    <mark>};</mark></code>
            </div>
            <code>});</code>
        </pre>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">SwitchMap и запросы</h2>
    <div class="slide-description">
        <br>
        <img class="img-boxed img-centered" width="650" src="pictures/fetch-cancel.png" alt="Отмена fetch-запросов">
    </div>
</section>

<section class="slide">
    <h2 class="shout">
        ДЕМО
    </h2>
</section>

<section class="slide">
    <h2 class="slide-header">Демо: поток ввода</h2>
    <div class="slide-search">
        <pre class="search-code">
            <code><span class="rxjs-creation">fromEvent</span>(inputElement, 'input')</code>
            <code>    .<span class="rxjs-pipe">pipe</span>(</code>
            <code class="next">        <span class="rxjs-operator">map</span>((event) => event.target.value)</code>
            <div class="next">
            <code>    )</code>
            <code>    .<span class="rxjs-subscribe">subscribe</span>(logToOutput)</code>
            </div>
        </pre>
        <div class="search-playground" id="searchDemo1">
            <input type="text" class="search-input" onfocus="searchDemo1()">
            <div class="search-output">
            </div>
        </div>
    </div>

    <script>
        function searchDemo1() {
            const playgroundElement = document.getElementById('searchDemo1');
            const inputElement = playgroundElement.querySelector('.search-input');
            const outputElement = playgroundElement.querySelector('.search-output');
            const onHashChange$ = rxjs.fromEvent(window, 'hashchange')
                .pipe(
                    rxjs.operators.take(1)
                );
            const blur$ = rxjs.fromEvent(inputElement, 'blur')
                .pipe(
                    rxjs.operators.take(1)
                );

            return rxjs.fromEvent(inputElement, 'input')
                .pipe(
                    rxjs.operators.map((event) => event.target.value),
                    rxjs.operators.takeUntil(onHashChange$),
                    rxjs.operators.takeUntil(blur$)
                )
                .subscribe({
                    next: (value) => logToOutput(outputElement, value),
                    complete: () => {
                        inputElement.value = '';
                        outputElement.innerHTML = ''
                    }
                });
        }
    </script>
</section>

<section class="slide">
    <h2 class="slide-header">Демо: дебаунс</h2>
    <div class="slide-search">
        <pre class="search-code">
            <code><span class="rxjs-creation">fromEvent</span>(inputElement, 'input')</code>
            <code>    .<span class="rxjs-pipe">pipe</span>(</code>
            <code>        <span class="rxjs-operator">map</span>((event) => event.target.value),</code>
            <code>        <mark><span class="rxjs-operator">debounceTime</span>(500)</mark></code>
            <code>    )</code>
            <code>    .<span class="rxjs-subscribe">subscribe</span>(logToOutput)</code>
        </pre>
        <div class="search-playground" id="searchDemo3">
            <input type="text" class="search-input" onfocus="searchDemo3()">
            <div class="search-output">
            </div>
        </div>
    </div>

    <script>
        function searchDemo3() {
            const playgroundElement = document.getElementById('searchDemo3');
            const inputElement = playgroundElement.querySelector('.search-input');
            const outputElement = playgroundElement.querySelector('.search-output');
            const onHashChange$ = rxjs.fromEvent(window, 'hashchange')
                .pipe(
                    rxjs.operators.take(1)
                );
            const blur$ = rxjs.fromEvent(inputElement, 'blur')
                .pipe(
                    rxjs.operators.take(1)
                );


            return rxjs.fromEvent(inputElement, 'input')
                .pipe(
                    rxjs.operators.map((event) => event.target.value),
                    rxjs.operators.debounceTime(500),
                    rxjs.operators.takeUntil(onHashChange$),
                    rxjs.operators.takeUntil(blur$)
                )
                .subscribe({
                    next: (value) => logToOutput(outputElement, value),
                    complete: () => {
                        inputElement.value = '';
                        outputElement.innerHTML = ''
                    }
                });
        }
    </script>
</section>

<section class="slide">
    <h2 class="slide-header">Демо: фильтрация совпадений</h2>
    <div class="slide-search">
        <pre class="search-code">
            <code><span class="rxjs-creation">fromEvent</span>(inputElement, 'input')</code>
            <code>    .<span class="rxjs-pipe">pipe</span>(</code>
            <code>        <span class="rxjs-operator">map</span>((event) => event.target.value),</code>
            <code>        <span class="rxjs-operator">debounceTime</span>(500),</code>
            <code>        <mark><span class="rxjs-operator">distinctUntilChanged</span>()</mark></code>
            <code>    )</code>
            <code>    .<span class="rxjs-subscribe">subscribe</span>(logToOutput)</code>
        </pre>
        <div class="search-playground" id="searchDemo4">
            <input type="text" class="search-input" onfocus="searchDemo4()">
            <div class="search-output">
            </div>
        </div>
    </div>

    <script>
        function searchDemo4() {
            const playgroundElement = document.getElementById('searchDemo4');
            const inputElement = playgroundElement.querySelector('.search-input');
            const outputElement = playgroundElement.querySelector('.search-output');
            const onHashChange$ = rxjs.fromEvent(window, 'hashchange')
                .pipe(
                    rxjs.operators.take(1)
                );
            const blur$ = rxjs.fromEvent(inputElement, 'blur')
                .pipe(
                    rxjs.operators.take(1)
                );


            return rxjs.fromEvent(inputElement, 'input')
                .pipe(
                    rxjs.operators.map((event) => event.target.value),
                    rxjs.operators.debounceTime(500),
                    rxjs.operators.distinctUntilChanged(),
                    rxjs.operators.takeUntil(onHashChange$),
                    rxjs.operators.takeUntil(blur$)
                )
                .subscribe({
                    next: (value) => logToOutput(outputElement, value),
                    complete: () => {
                        inputElement.value = '';
                        outputElement.innerHTML = ''
                    }
                });
        }
    </script>
</section>

<section class="slide">
    <h2 class="slide-header">Демо: запрос данных</h2>
    <div class="slide-search">
        <pre class="search-code">
            <code><span class="rxjs-creation">fromEvent</span>(inputElement, 'input')</code>
            <code>    .<span class="rxjs-pipe">pipe</span>(</code>
            <code>        <span class="rxjs-operator">map</span>((event) => event.target.value),</code>
            <code>        <span class="rxjs-operator">debounceTime</span>(500),</code>
            <code>        <span class="rxjs-operator">distinctUntilChanged</span>(),</code>
            <code>        <mark><span class="rxjs-operator">switchMap</span>(query => fetchData(query))</mark></code>
            <code>    )</code>
            <code>    .<span class="rxjs-subscribe">subscribe</span>(logToOutput)</code>
        </pre>
        <div class="search-playground" id="searchDemo5">
            <input type="text" class="search-input" onfocus="searchDemo5()">
            <div class="search-output">
            </div>
        </div>
    </div>

    <script>
        function searchDemo5() {
            const playgroundElement = document.getElementById('searchDemo5');
            const inputElement = playgroundElement.querySelector('.search-input');
            const outputElement = playgroundElement.querySelector('.search-output');
            const onHashChange$ = rxjs.fromEvent(window, 'hashchange')
                .pipe(
                    rxjs.operators.take(1)
                );
            const blur$ = rxjs.fromEvent(inputElement, 'blur')
                .pipe(
                    rxjs.operators.take(1)
                );


            return rxjs.fromEvent(inputElement, 'input')
                .pipe(
                    rxjs.operators.map((event) => event.target.value),
                    rxjs.operators.debounceTime(500),
                    rxjs.operators.distinctUntilChanged(),
                    rxjs.operators.switchMap(value => fetchData(value)),
                    rxjs.operators.takeUntil(onHashChange$),
                    rxjs.operators.takeUntil(blur$)
                )
                .subscribe({
                    next: (items) => logAllToOutput(outputElement, items),
                    complete: () => {
                        inputElement.value = '';
                        outputElement.innerHTML = ''
                    }
                });
        }
    </script>
</section>

<section class="slide">
    <h2 class="slide-header">Демо: лоадер</h2>
    <div class="slide-search">
        <pre class="search-code">
            <code><span class="rxjs-creation">fromEvent</span>(inputElement, 'input')</code>
            <code>    .<span class="rxjs-pipe">pipe</span>(</code>
            <code>        <span class="rxjs-operator">map</span>((event) => event.target.value),</code>
            <code>        <span class="rxjs-operator">debounceTime</span>(500),</code>
            <code>        <span class="rxjs-operator">distinctUntilChanged</span>(),</code>
            <code>        <mark><span class="rxjs-operator">tap</span>(() => setLoading(true))</mark>,</code>
            <code>        <span class="rxjs-operator">switchMap</span>(query => fetchData(query)),</code>
            <code>        <mark><span class="rxjs-operator">tap</span>(() => setLoading(false))</mark></code>
            <code>    )</code>
            <code>    .<span class="rxjs-subscribe">subscribe</span>(logToOutput)</code>
        </pre>
        <div class="search-playground" id="searchDemo6">
            <input type="text" class="search-input" onfocus="searchDemo6()">
            <div class="search-output">
            </div>
        </div>
    </div>

    <script>
        function searchDemo6() {
            const playgroundElement = document.getElementById('searchDemo6');
            const inputElement = playgroundElement.querySelector('.search-input');
            const outputElement = playgroundElement.querySelector('.search-output');
            const onHashChange$ = rxjs.fromEvent(window, 'hashchange')
                .pipe(
                    rxjs.operators.take(1)
                );
            const blur$ = rxjs.fromEvent(inputElement, 'blur')
                .pipe(
                    rxjs.operators.take(1)
                );

            const setLoading = (flag) => {
                outputElement.classList.toggle('search-loading', flag);
            };

            return rxjs.fromEvent(inputElement, 'input')
                .pipe(
                    rxjs.operators.tap(() => {
                        outputElement.innerHTML = ''
                    }),
                    rxjs.operators.map((event) => event.target.value),
                    rxjs.operators.debounceTime(500),
                    rxjs.operators.distinctUntilChanged(),
                    rxjs.operators.tap(() => setLoading(true)),
                    rxjs.operators.switchMap(value => fetchData(value)),
                    rxjs.operators.tap(() => setLoading(false)),
                    rxjs.operators.takeUntil(onHashChange$),
                    rxjs.operators.takeUntil(blur$)
                )
                .subscribe({
                    next: (items) => logAllToOutput(outputElement, items),
                    complete: () => {
                        inputElement.value = '';
                        outputElement.innerHTML = ''
                    }
                });
        }
    </script>
</section>

<section class="slide">
    <h2 class="slide-header">Демо: результаты</h2>
    <div class="slide-search">
        <pre class="search-code">
            <code><span class="rxjs-creation">fromEvent</span>(inputElement, 'input')</code>
            <code>    .<span class="rxjs-pipe">pipe</span>(</code>
            <code>        <span class="rxjs-operator">map</span>((event) => event.target.value),</code>
            <code>        <span class="rxjs-operator">debounceTime</span>(500),</code>
            <code>        <span class="rxjs-operator">distinctUntilChanged</span>(),</code>
            <code>        <span class="rxjs-operator">tap</span>(() => setLoading(true)),</code>
            <code>        <span class="rxjs-operator">switchMap</span>(query => fetchData(query)),</code>
            <code>        <span class="rxjs-operator">tap</span>(() => setLoading(false))</code>
            <code>    )</code>
            <code>    .<span class="rxjs-subscribe">subscribe</span>(logToOutput)</code>
        </pre>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Демо: результаты</h2>
    <div class="slide-description">
        <p>Работаем с потоками, <br>
            а не с промежуточными состояниями</p>
        <ul>
            <li>видна вся последовательность обработки</li>
            <li>минимум сайд эффектов</li>
            <li>самодостаточный компонент</li>
        </ul>
    </div>
</section>

<section class="slide">
    <h2 class="shout">
        SUBJECTS
    </h2>
</section>

<section class="slide">
    <h2 class="slide-header">1 подписка - 1 поток значений</h2>
    <div class="slide-description">
        <div class="playground playground-three-streams" id="observableMultiSubs"></div>
        <button class="btn btn-play" onclick="run(observableMultiSubs, this)">▶</button>
    </div>
    <small>
        <pre>
            <code>const stream$ = <span class="rxjs-creation">timer</span>(0, 500).<span class="rxjs-pipe">pipe</span>(</code>
                <code>    <span class="rxjs-operator">take</span>(5),</code>
                <code>    <span class="rxjs-operator">map</span>(() => random()));</code>
                <code class="next">stream$.<span class="rxjs-subscribe">subscribe</span>(/* ... */);</code>
                <code class="next">stream$.<span class="rxjs-subscribe">subscribe</span>(/* ... */);</code>
                <div class="next">
                <code>setTimeout(() => {</code>
                    <code>    stream$.<span class="rxjs-subscribe">subscribe</span>(/* ... */);</code>
                <code>}, 800);</code>
                </div>
        </pre>
    </small>
    <script>
        function observableMultiSubs() {
            const playgroundElement = document.getElementById('observableMultiSubs');
            playgroundElement.innerHTML = '';

            const stream$ = rxjs.timer(0, TICK_MS)
                .pipe(
                    rxjs.operators.take(5),
                    rxjs.operators.map(() => Math.random().toString().substr(2, 2))
                );

            startStream(playgroundElement, stream$);
            startStream(playgroundElement, stream$);
            startStream(playgroundElement, stream$, 800);
        }
    </script>
</section>

<section class="slide">
    <h2 class="slide-header">Subject</h2>
    <div class="slide-description">
        <p>Объединение Observable и Observer. <br>Передает значение всем подписчикам</p>
    </div>
    <div class="relative-container">
        <small>
            <pre>
                <code>const subject = new <span class="rxjs-creation">Subject</span>();</code>
                <code> </code>
                <code>subject.next(0);</code>
                <code>setTimeout(() => subject.next(1), 1000);</code>
                <code>setTimeout(() => subject.next(2), 2000);</code>
                <code>setTimeout(() => subject.next(3), 3000);</code>
                <code>setTimeout(() => subject.next(4), 4000);</code>
                <code>setTimeout(() => subject.complete(), 5000);</code>
            </pre>
        </small>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Subject</h2>
    <div class="slide-description">
        <div class="playground playground-three-streams" id="subjectIntro"></div>
        <button class="btn btn-play" onclick="run(subjectIntro, this)">▶</button>
    </div>
    <div class="relative-container">
        <small>
        <pre>
                <code>const subject = new <span class="rxjs-creation">Subject</span>();</code>
                <code>setSubjectTick(subject);</code>
                <code>&nbsp;</code>
                <code>subject.<span class="rxjs-subscribe">subscribe</span>();</code>
                <code>setTimeout(() => subject.<span class="rxjs-subscribe">subscribe</span>(/* ... */), 1500);</code>
                <code>setTimeout(() => subject.<span class="rxjs-subscribe">subscribe</span>(/* ... */), 2500);</code>
        </pre>
        </small>
    </div>
    <script>
        function subjectIntro() {
            const playgroundElement = document.getElementById('subjectIntro');
            playgroundElement.innerHTML = '';

            const subject = new rxjs.Subject();
            setSubjectTick1(subject);

            startStream(playgroundElement, subject);
            startStream(playgroundElement, subject, 1500);
            startStream(playgroundElement, subject, 2500);
        }
    </script>
</section>

<section class="slide">
    <h2 class="slide-header">Пример - автоотписка</h2>
    <div class="slide-description">
        <pre>
            <code>const subscription = streamA$.<span class="rxjs-pipe">pipe</span>(</code>
            <code>    <span class="rxjs-operator">map</span>(...),</code>
            <code>    <span class="rxjs-operator">switchMap</span>(...)</code>
            <code>).<span class="rxjs-subscribe">subscribe</span>(...);</code>
            <div class="next">
            <code>...</code>
            <code>onDestroy() {</code>
                <code>    subscription.<span class="rxjs-subscribe">unsubscribe</span>();</code>
                <code class="next">    subscription2.<span class="rxjs-subscribe">unsubscribe</span>();</code>
                <code class="next">    subscription3.<span class="rxjs-subscribe">unsubscribe</span>();</code>
                <code class="next">    subscription4.<span class="rxjs-subscribe">unsubscribe</span>();</code>
                <div class="next">
                <code>    ...</code>
                <code>}</code>
                </div>
            </div>
        </pre>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Пример - автоотписка</h2>
    <div class="slide-description">
        <pre>
            <code>const destroy$ = new <span class="rxjs-creation">Subject</span>();</code>
            <div class="next">
            <code>streamA$.<span class="rxjs-pipe">pipe</span>(</code>
            <code>    <span class="rxjs-operator">map</span>(...),</code>
            <code>    <span class="rxjs-operator">switchMap</span>(...),</code>
            <code>    <span class="rxjs-operator">takeUntil</span>(<mark>destroy$</mark>)</code>
            <code>).<span class="rxjs-subscribe">subscribe</span>()</code>
            <code>...</code>
            </div>
            <div class="next">
            <code>onDestroy() {</code>
            <code>    destroy$.<span class="rxjs-subscribe">next</span>();</code>
            <code>}</code>
            </div>
        </pre>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Пример - авторизация</h2>
    <div class="slide-description">
        <pre>
            <code>class StateService {</code>
            <code>  private <mark>authSubject</mark> = new <span class="rxjs-creation">BehaviorSubject</span>&lt;boolean&gt;(false);</code>
            <div class="next">
            <code> </code>
            <code>  setAuthState(state: boolean) {</code>
            <code>    this.authSubject.<span class="rxjs-subscribe">next</span>(state);</code>
            <code>  }</code>
            </div>
            <code>}</code>
        </pre>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Пример - авторизация</h2>
    <div class="slide-description">
        <pre>
            <code>class StateService {</code>
            <code>  private <mark>authSubject</mark> = new <span class="rxjs-creation">BehaviorSubject</span>&lt;boolean&gt;(false);</code>
            <code>  setAuthState(state: boolean) {...}</code>
            <div class="next">
            <code> </code>
            <code>  getStateChange(): Observable&lt;boolean&gt; {</code>
            <code>    return this.authSubject.<span class="rxjs-subscribe">asObservable</span>();</code>
            <code>  }</code>
            </div>
            <code>}</code>
        </pre>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Пример - авторизация</h2>
    <div class="slide-description">
        <pre>
            <code>class StateService {</code>
            <code>  private <mark>authSubject</mark> = new <span class="rxjs-creation">BehaviorSubject</span>&lt;boolean&gt;(false);</code>
            <code>  setAuthState(state: boolean) {...}</code>
            <code>  getStateChange(): Observable&lt;boolean&gt; {...}</code>
            <code> </code>
            <div class="next">
            <code>  getCurrentState(): boolean {</code>
            <code>    return this.authSubject.<span class="rxjs-subscribe">getValue</span>();</code>
            <code>  }</code>
            </div>
            <code>}</code>
        </pre>
    </div>
</section>

<!-- <section class="slide">
    <h2 class="slide-header">Пример - кеширование</h2>
    <div class="slide-description">
        <pre>
            <code>let cachingSubject;</code>
            <code> </code>
            <code>getResource() {</code>
            <div class="next">
            <code>    if (!cachingSubject) {</code>
            <div class="next">
            <code>      cachingSubject = new <span class="rxjs-creation">ReplaySubject</span>(1);</code>
            </div>
            <div class="next">
            <code> </code>
            <code>      loadData().<span class="rxjs-subscribe">subscribe</span>((result) => {</code>
            <code>          this.cachingSubject.<span class="rxjs-subscribe">next</span>(result);</code>
            <code>        });</code>
            </div>
            <code>    }</code>
            </div>
            <div class="next">
            <code> </code>
            <code>    return this.cachingSubject.<span class="rxjs-subscribe">asObservable</span>();</code>
            </div>
            <code>}</code>
        </pre>
    </div>
</section> -->



<section class="slide">
    <h2 class="shout">
        Создание кастомного оператора
    </h2>
</section>

<section class="slide">
    <h2 class="slide-header">Правила создания</h2>
    <div class="slide-description">
        <ul>
            <li>Операторы всегда должны возвращать Observable</li>
            <li>Оператор должен иметь подписку на исходный Observable внутри возвращаемого</li>
            <li>Обработка исключений</li>
            <li>Нельзя допускать утечек памяти</li>
        </ul>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">truthyFilter()</h2>
    <div class="slide-description">
        <pre>
            <code>function truthyFilter&lt;T&gt;(): MonoTypeOperatorFunction&lt;T&gt; {</code>
            <code>    return input$ =&gt; input$.pipe(filter(Boolean));</code>
            <code>}</code>
        </pre>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Типы возвращаемых значений</h2>
    <div class="slide-description">
        <ul>
            <li class="next">MonoTypeOperatorFunction - тип не меняется</li>
            <li class="next">OperatorFunction - переключается поток или изменяется тип</li>
        </ul>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Использование кастомного оператора</h2>
    <div class="slide-description">
        <div class="playground playground-three-streams" id="customFilter"></div>
        <button class="btn btn-play" onclick="run(runCustomFilter, this)">▶</button>
    </div>
    <div class="relative-container">
        <small>
        <pre>
            <code>const values = [0, 1, null, '', 'foo', undefined, 'bar'];</code>
            <code></code>
            <code>from(values),pipe(</code>
            <code>  delay(100),</code>
            <code>  truthyFilter()</code>
            <code>)</code>
        </pre>
        </small>
    </div>
    <script>
        function runCustomFilter() {
            const playgroundElement = document.getElementById('customFilter');
            playgroundElement.innerHTML = '';

            function truthyFilter() {
                return input$ => input$.pipe(rxjs.operators.filter(Boolean));
            }

            const values = [0, 1, null, '', 'foo', undefined, 'bar'];

            startStream(playgroundElement, rxjs.interval(300).pipe(
                rxjs.operators.map(index => values[index]),
                truthyFilter(),
                rxjs.operators.take(3)
            ));
        }
    </script>
</section>

<section class="slide">
    <h2 class="slide-header">Тестирование</h2>
    <div class="slide-description next">
        <small>
        <pre>
            <code>describe('truthyFilter оператор:', () =&gt; {</code>
            <code>  it('должен оставить только истинные значения', () =&gt; {</code>
            <code>    from([0, 1, null, '', 'foo', undefined, 'bar', [], {}])</code>
            <code>        .pipe(</code>
            <code>          truthyFilter(),</code>
            <code>          reduce((acc, value) =&gt; [...acc, value], [])</code>
            <code>        )</code>
            <code>       .subscribe({</code>
            <code>            next: result =&gt; {</code>
            <code>              expect(result).toEqual([1, 'foo', 'bar', [], {}])</code>
            <code>            }</code>
            <code>       })</code>
            <code>   })</code>
            <code>})</code>
        </pre>
        </small>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Marbles тестирование</h2>
    <div class="slide-description next">
        <small>
        <pre>
            <code>describe('truthyFilter оператор:', () =&gt; {</code>
            <code>  it('должен оставить только истинные значения', () =&gt; {</code>
            <code>    const source = from([0, 1, null, '', 'foo', undefined, 'bar', [], {}])</code>
            <code>        .pipe(truthyFilter());</code>
            <code> </code>
            <code>    const expected = cold('abcde', {a: 1, b: 'foo', c: 'bar', d: [], e: {}});</code>
            <code> </code>
            <code>    expect(source).toBeObservable(expected);</code>
            <code>   })</code>
            <code>})</code>
        </pre>
        </small>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">consoleLog()</h2>
    <div class="slide-description">
        <pre>
            <code>function consoleLog&lt;T&gt;(): MonoTypeOperatorFunction&lt;T&gt; {</code>
            <code>    // return input$ =&gt; input$.pipe(tap(console.log));</code>
            <code>    return tap(console.log);</code>
            <code>}</code>
        </pre>
    </div>
</section>

<section class="slide">
    <h2 class="slide-header">Преобразование lodash в Rxjs операторы</h2>
    <div class="slide-description">
        <small>
        <pre>
            <code>const pickNumbers = () =&gt; map(x =&gt; {</code>
            <code>    _.pickBy(x, _.isNumber)</code>
            <code>});</code>
            <code> </code>
            <code>const source$ = of({'foo': 1, 'bar': 'str', 'baz': 3});</code>
            <code> </code>
            <code>source$.pipe(pickNumbers()).subscribe();</code>
            <code> </code>
            <code>// {'foo': 1, 'baz': 3}</code>
        </pre>
        </small>
    </div>
</section>

<section class="slide">
    <h2 class="shout">
        Библиотеки с готовыми операторами
    </h2>
</section>

<section class="slide">
    <h2 class="slide-header">"rxjs-etc" Nickolas Jamieson</h2>
    <div class="slide-description">

        <ul>
            <li>Плюсы</li>
            <li class="next">Rxjs Core team maintainer</li>
            <li class="next">операторы которые пока не попали в rxjs</li>
        </ul>

        <ul class="next">
            <li>Минусы</li>
            <li>много узконаправленных операторов</li>
        </ul>
    </div>
</section>

<section class="slide">
    <h2 class="shout">
        Вопросы
    </h2>
</section>

<!-- mutation
intersection -->


<div class="progress"></div>

<script src="node_modules/shower-core/shower.min.js"></script>
<script src="node_modules/rxjs/bundles/rxjs.umd.min.js"></script>
<script src="./custom-scripts.js"></script>
<!-- Copyright © 2018 Andrey Alexeev -->
</body>
</html>
